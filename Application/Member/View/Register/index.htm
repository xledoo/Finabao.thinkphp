<!-- BEGIN BREADCRUMBS -->   
    <div class="row breadcrumbs margin-bottom-40">
        <div class="container">
            <div class="col-md-4 col-sm-4">
                <h1>Register 会员注册</h1>
            </div>
            <div class="col-md-8 col-sm-8">
                    <ul class="pull-right breadcrumb">
                        <li><a href="{:U('Home/Index/index')}">首页</a></li>
                        <li><a href="{:U('Member/Index/index')}">会员中心</a></li>
                        <li class="active">会员注册</li>
                    </ul>
            </div>
        </div>
    </div>
<!-- END BREADCRUMBS -->


<!-- BEGIN CONTAINER -->   
    <div class="container margin-bottom-40">
    	<!--/row-->
        <div class="row">
            <form action="{:U('Member/Register/Submit')}" id="register_form" method="post" class="form-horizontal">
                <input type="hidden" name="formhash" value="{$formhash}">
				<div class="col-md-4">
					<div class="row">
						<img src="assets/img/photos/img4.jpg">
					</div>
				</div>
				<div class="col-md-8">
					<div class="row">
						<div class="col-md-6">
							<div class="input-group margin-bottom-20">
			                    <span class="input-group-addon"><i class="fa fa-user"></i></span>
			                    <input type="text" class="form-control" onblur="ajax_check(this.id, this.value);" placeholder="用户名" name="username" id="username"  >
			                </div>
			            	<div class="input-group margin-bottom-20">
			                    <span class="input-group-addon"><i class="fa fa-lock"></i></span>
			                    <input type="password" class="form-control" onblur="ajax_check(this.id, this.value);" placeholder="密码" name="password" id="password" >
			                </div>
			                <div class="input-group margin-bottom-20">
			                    <span class="input-group-addon"><i class="fa fa-lock"></i></span>
			                    <input type="password" class="form-control" onblur="ajax_check(this.id, this.value);" placeholder="确认密码" name="password2" id="password2" >
			                </div>
						</div>
						<div class="col-md-6">
							<div class="input-group margin-bottom-20">
			                    <span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
			                    <input type="text" class="form-control" onblur="ajax_check(this.id, this.value);" placeholder="邮箱" name="email" id="email" >
			                </div>
			            	<div class="input-group margin-bottom-20">
			                    <span class="input-group-addon"><i class="fa fa-apple"></i></span>
			                    <input type="text" class="form-control" onblur="ajax_check(this.id, this.value);" placeholder="手机号码" name="mobile" id="mobile" >
			                </div>
			                <div class="input-group margin-bottom-20">
			                    <span class="input-group-addon"><i class="glyphicon glyphicon-qrcode"></i></span>
			                    <input type="text" class="form-control sign" onblur="ajax_check(this.id, this.value);" data-loading-text="Loading..." placeholder="短信验证码" name="sign" style="width:226px">
			                    <div class="input-group-btn">
                                    <button class="btn btn-info green" type="button" id="smscheck">短信验证码</button>
                                </div>
			                </div>
						</div>
						<div class="col-md-12">
						      <input type="submit" class="btn btn-info green col-md-12" name="register" value="提交注册" id="register_submit">
                        </div>
					</div>
				</div>	            	
            </form>
        </div>
    </div>
<!-- END CONTAINER -->


<script type="text/javascript">
function ajax_check(id, val){
	jQuery.getJSON('index.php?m=member&c=register&a=ajax_check&type='+id+'&data='+val, function(json){
		var pre = jQuery("#" + id).parent().attr('class');

		if(json['error'] == 0){
			// jQuery('#' + id)[0].parentNode.className.replace(/has-error/,json['class']);
			// jQuery("#" + id).parent().toggleClass(json['class']);
			
            jQuery("#" + id).parent().removeClass('has-error');
            jQuery("#" + id).parent().addClass(json['class']);

			// var aft = pre.substr(0,11) + json['class'];

			// alert(aft);
			// alert(jQuery("#" + id)[0].parentNode.className);
			
            alert(json['message']);

			//二次密码确认
			if(id == 'password2'){
				// alert(json['data']);exit();
				if(json['data'] == jQuery("#password").val()){
					alert('密码确认成功！');
				} else {
					// aft = pre + ' has-error';
					// alert(aft);
                    jQuery("#" + id).parent().removeClass('has-success');
                    jQuery("#" + id).parent().addClass('has-error');
					alert('两次密码不一致！');

				}
			}
			
			
		} else {
			jQuery('#' + id)[0].parentNode.className.replace(/has-success/,json['class']);

			// jQuery("#" + id).parent().toggleClass(json['class']);

            jQuery("#" + id).parent().removeClass('has-success');
            jQuery("#" + id).parent().addClass(json['class']);

			// var aft = pre + json['class'];

			// alert(aft);
			// alert(jQuery("#" + id).parent().attr("class"));
			// alert(jQuery("#" + id)[0].parentNode.className);
			alert(json['message']);
		}

		
	});
	return false;
}

jQuery("#smscheck").click(function(){
    var err =   0;
    jQuery(".form-control").each(function(i){
        if(this.id){
            // alert(this.parentNode.className);
            if(!this.parentNode.className.match(/ has-success/)){
                jQuery(".input-group input").eq(i).focus();
                err = 1;
                return false;
            }
        }
    });
    if(err == 0){
        jQuery.getJSON('index.php?m=member&c=register&a=SMSend_verify&mobile='+jQuery('#mobile').val, function(s){
            if(s == 'succeed'){
                alert('验证短信已经发送成功，请等待...');
                jQuery("#smscheck").attr("disabled", "disabled");
            } else {
                alert('验证短信发送失败');
            }
        });
    }
});



jQuery("#register_form").submit(function(){
    var err =   0;
	jQuery(".form-control").each(function(i){
		if(this.id){
			if(!this.parentNode.className.match(/ has-success/)){
				jQuery(".input-group input").eq(i).focus();
				err = 1;
				return false;
			}
		}
	});
	return false;
});

 // $('.sign').click(function () {
 //    var btn = $(this)
 //    btn.button('loading')
 //    $.ajax(...).always(function () {
 //      btn.button('reset')
 //    });
 //  });

</script>


</div>
<!-- END PAGE CONTAINER -->

